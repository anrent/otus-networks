# Развертывание коммутируемой сети с резервными каналами

## Задачи
#### Часть 1. Создание сети и настройка основных параметров устройства
#### Часть 2. Выбор корневого моста
#### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
#### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов


## Часть 1:	Создание сети и настройка основных параметров устройства

Топология сети, построенная в Packet Tracer:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/topo.PNG)

Команды предварительной настройки
```
enable
conf t
no ip domain-lookup                        //Отключение DNS lookup, чтобы устройство не пыталось преобразовать неправильно введенные команды, как если бы они были именами хостов.
service password-encryption                //Шифрование паролей     
hostname S2                                //R1 S1 соответственно
enable secret class                        //Включение запроса пароля для привелигированного режима
line console 0                             //Конфигурация консольной линии
password cisco                             //Пароль, запршиваемый при подключении к устройству через консоль
logging synchronous                        //Синхронизация консольных лог сообщений с вводом команд
exit
line vty 0 15                              //Конфигурация vty линий
login                                      //Необходимость ввода общего пароля
password cisco                             //Пароль, запршиваемый при подключении к устройству через vty линии
exit
banner motd "Hello there"                  //Баннер
interface vlan 1
ip address 192.168.1.1 255.255.255.0       //Адреса для S2 - .1 дял S3 - .3
exit
copy running-config startup-config         //сохранение конфигурации
```
Проверка работоспособности:

Доступность S2 от S1:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/s1-s2.PNG)

Доступность S3 от S1:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/s1-s3.PNG)

Доступность S3 от S2:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/s2-s3.PNG)



## Часть 2:	Определение корневого моста

Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.
Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768.
Используя построенную ранее топологию, были выполнены дополнительные шаги по настройке оборудования:

 * Отключены все порты на коммутаторах.
 * Настроены подключенные порты в качестве транковых.
 * Включены порты F0/2 и F0/4 на всех коммутаторах.
 * Выведены данные состояния протокола spanning-tree.
 
#### Ниже приведён вывод информации о состоянии протокола STP

Для коммутатора S1:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/S1stp.PNG)


Для коммутатора S2:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/S2stp.PNG)


Для коммутатора S3:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/S3stp.PNG)


На схеме ниже наглядно указано состояние портов и root коммутатор:

![Image alt](https://github.com/anrent/otus-networks/blob/main/labs/lab02/STP-pt1.PNG)

В данном случае S3 является корневым коммутатором пот той причине, что он имеет наименьший BID (MAC адрес, учитывая, что приоритет равный на всех коммутаторах).
Если рассматривать остальные коммутаторы, то порты Fa0/4 для S1 и S2 являются корневыми портами, по той причине, что они имеют наименьшую административную (корневую) стоимость между ними и корневым коммутатором. 
Назначенный (Designated) порт в данной схеме - Fa0/2 коммутатора S1, по той причине, что он имеет наименьшую корневую стоимость.
Альтернативный, заблокированный порт - Fa0/2 коммутатора S2. Именно он, а не Fa0/2 S1, заблокирован из-за того, что коммутатор S2 имеет больший BID (MAC адрес, при том, что приоритеты у них равн).


## Часть 3:	Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

При изменении в данной топологии стоимости заблокированного порта Fa0/2 коммутатора S2 в меньшую сторону, произойдёт конвергенция и заблокированным станет Fa0/2 S1. По причине того, что корневая стоимость через Fa0/2 коммутатора S2 будет меньше и он станет назнеченным, а Fa0/2 S1, соответственно заблокированным.


## Часть 4:	Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

При включении в данной топологии всех портов, то выбор корневого/выделенного/альтернативного порта в рамках одного устройства. Будет происходить по двум параметрам - корневой стоимости и номеру порта. Т.е, например, несколько портов на одном и том же коммутаторе , ведущие в один сегмент сети, при одинаковой корневой стоимости, то победит тот порт, который будет имень меньший номер, остальные переведутся в состояние блокировки.

